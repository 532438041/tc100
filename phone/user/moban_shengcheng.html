<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="description" content="" />
        <meta name="keywords" content="" />
        <meta name="author" content="Flying hormone" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta charset="UTF-8">
        <link rel="stylesheet" href="../css/media.css" />
        <link rel="stylesheet" href="../css/mui.min.css" />
        <link rel="stylesheet" href="../css/head_foot.css" />
        <script type="text/javascript" src="../js/jquery-1.9.1.js"></script>
        <script type="text/javascript" src="../js/jquery.Query.js" ></script>
        <script type="text/javascript" src="../js/jquery-cookie.js"></script>
        <script type="text/javascript" src="../js/mui.min.js"></script>
        <script type="text/javascript" src="../js/appcan.js"></script>
        <script type="text/javascript" src="../js/appcan.control.js"></script>
        <script type="text/javascript" src="../js/common.js" ></script>
        <link rel="stylesheet" href="../js/webuploader/webuploader.css" />
        <script type="text/javascript" src="../js/webuploader/webuploader.js" ></script>
		<title>模版生成</title>
		<style>
            
            section {
                background: #fff;
                margin-top: 0.625em;
            }
            
            section div {
                height: auto;
                background: #fff;
                overflow: hidden;
                clear: both;
            }
            
            section h3 {
                font-size: 0.8em;
                font-weight: bold;
                height: 3em;
                line-height: 3em;
                float: left;
                text-indent: 1em;
            }
            
            section p {
                float: right;
                height: 3em;
                line-height: 3em;
            }
            
            section p span {
                margin-top: 0.1875em;
                margin-right: 0.625em;
            }
            
            section p a {
                color: #ff3366;
                border: 1px solid #ff3366;
                padding: 0 0.625em;
                border-radius: 0.3125em;
                margin-right: 0.3125em;
            }
            
            section i ,.lei_1 li{
                font-style: normal;
                font-weight: normal;
                font-size: 0.8em;
                color: #cd4400;
            }
            
            section li {
                height: 3.125em;
                line-height: 3.125em;
                clear: both;
            }
            
            section h4 {
                color: #666;
                line-height: 3.125em;
                float: left;
                margin-left: 1.25em;
                margin-left: 4em;
                font-size: 0.8em;
            }
            
            li p {
                float: right;
            }
            
            section li a {
                color: #ccc;
                border: 1px solid #ccc;
                padding: 0 0.625em;
                border-radius: 0.3125em;
            }
            
            .shuoming h3 {
                color: #999;
            }
            
            .shuoming li {
                padding: 0 1em;
                line-height: 1.25em;
                height: auto;
                overflow: hidden;
                color: #666;
            }
            
            @media screen and (max-width: 360px) {
                body {
                    background-color: lightblue;
                }
                section.sec_3 div.tu_tu i {
                    padding: 0;
                }
                section.sec_3 div.tu_tu span {
                    margin: 0;
                }
            }
            textarea{ height: 6.5em; margin: 0 4%; margin-top:1em; width: 92%; font-size: 0.8em; line-height: 1.2em; padding: 1em;}
            .upload h3{ font-style: normal; font-weight: normal; width: 100%; color: #666;}
            .upload h3 input[type=text]{ width: auto; display: inline; height: 1.875em; margin-left: 0.625em;     font-size: 1em;
    margin-bottom: 0;
    line-height: normal;}
            .pore{ position: relative;}
            .bitian{ position: absolute; right: 0.625em; top: 0;}
            .lei_1{ padding-top: 0.625em; background: #f8f8f8;}
            .lei_1 li{ text-align: center; margin-right: 1em; line-height: 1.25em; height: 1.875em; font-size: 0.8em;}
            .shouye img{ height: 0.625em;}
            .shouye>div .fir,.shouye>div .sec{float: left; clear: none; padding: 0 0.5em;}
            .shouye>div div img{ width: 100%; height: auto;}
            .shouye>div div p{ float: none; line-height: 1.25em; color: #666; }
            .shouye>div div a{ line-height:1.5em; display: block; width: 100%; text-align: center ; background: #ff3366; color: #fff;}
            .shouye .fir{ width: 33%; min-height: 6em;}
            .shouye .sec{ width: 64%; position: relative; height: 100%;}
            .xiangqing>div div{  float: left; clear: none; color: #666; padding-left: 0.5em;}
            .name{ padding-bottom: 1.25em;}
            .name a{ font-size: 1em; line-height: 1.2em; padding: 2px 0; display: block; float: left; background: #fff; color: #ff3366; border: 1px solid #FF3366; margin:0 3%; text-align: center; border-radius: 0.3125em;}
            .name a.active{ color: #fff; background: #ff3366;}
            .name a.w3{ width: 25%;}
            .name a.w4{ width: 30%;}
            .submit input:first-child{ font-size:1em; width: 60%; float: left; margin-left: 2.5%; height: 1.875em; line-height: 1.875em;}
            .submit input:last-child{ font-size:1em; width: 25%; margin: 0 5%;  height: 1.875em; line-height: 1.875em; padding: 0; background: #ff3366; border-color: #ff3366;}
            .mui-checkbox input[type=checkbox]:before, .mui-radio input[type=radio]:before{ font-size: 1.25em; line-height: 1.875em; color: #666!important;}
            #upload0{ display: none ;}
			.mui-checkbox input[type=checkbox]:before, .mui-radio input[type=radio]:before{
                line-height: 0;
            }
            .mui-checkbox.mui-left input[type=checkbox], .mui-radio.mui-left input[type=radio]{
                top: 20px
            }
            .mui-checkbox label, .mui-radio label{
                font-size: 0.8em;
            }
			.danxuan{
            }
            .danxuan label{
                font-size: 0.8em;
                line-height: 1.2em;
            }
            .danxuan input{
                float: left;
                height: 1.5em;
                width: 1.5em;
                font-size: 0.5em;
                margin:0 0.5em;
                margin-top: 0.2em
            }
            .webuploader-pick{
            line-height:1.5em; display: block; width: 100%; text-align: center ; 
            background: #ff3366; color: #fff;padding: 0 0;
            }
            .rightright{
                margin-top: 1em;
            }
            .shouye h3{ }
            .sec div{ margin-bottom: 1em; width：90%; font-size: 0.8em; line-height: 2em; height: 2em; background: #ff3366; border-radius: 0.2em; color: #fff; text-align:center;}
            .sec input[type=text]{width：90%;font-size: 0.8em; padding: 0.5em; margin: 0; height: 2em; line-height: 2em; }
            .thi div{ margin-bottom: 1em; width:80%; margin-left:10%; font-size: 0.8em; line-height: 2em; height: 2em; background: #ff3366; border-radius: 0.2em; color: #fff; text-align:center;}
            .shouye222 .fir{ width: 100%; padding: 0 5%;};
            .fir img{ width: 100%;}
            .border_b{ border-bottom: 1px solid #ccc;}
            #htmlStr{ display:none; padding: 1em; width: 100%; font-size: 0.8em; height: auto; overflow: hidden}
            #yulan{ height: 4.5em; width: 6em; overflow: hidden; float: left; margin-left: 4%;}
            #yulan img{ height: 100%; width: 100%; object-fit: cover;}
            #wenzhang{ width:92%; margin:1em 4%; height: auto; overflow: hidden; padding: 1em 4%; min-height: 6em; border:1px solid #ccc;}
            #wenzhang .wzimg{ display: block; width: 100%;}
            #wenzhang textarea{ width:100%; min-height: 1.5em; height: 1.5em; margin: 0; padding: 0; border: none; outline: none;}
            #wenzhang_tu .webuploader-pick{ font-size: 0.8em;float: right; margin-right: 4%; color: #fff;width: auto;background: #ff3366;padding: 0 5%;border-radius: 0.2em;}
            .opa{   
                    width:18%;
                    line-height: 2.5em;
                    position: absolute;
                    bottom: 0em;
                    right: 0em;
                    background: url(../img/opa_f36.png) repeat;
                    height: 2.5em;
                    color: #fff;
                    background-color: #000;
                    font-size: 0.6em;}
            .opa .opaimg{ height: 1.875em; width: auto; padding: 0; margin: 0; background: none; position: absolute; left: 0.3125em; top: 0.3125em; }
            
        </style>
	</head>

	<body>
		<header>
			<a><span class="leftleft"></span></a>
			<h1>模版生成</h1>
			<a class="xiaoxi6" href="javascript:;" onclick="openUrl('daizuo.html','daizuo')">请人代做</a>
		</header>
		<section class="shuoming">
			<div class="border_b">
				<h3>说明</h3>
				<p><span class="rightright"></span></p>
			</div>
			<ul id="htmlStr"></ul>
		</section>
		<section class="upload">
		    <form id="actForm">
		        <input type="hidden" name="mainPic" class="mainPic" value="" />
    			<div class="pore" style="display: none;">
    				<h3>输入位置代码<input id="code" type="text" value="" placeholder="输入位置代码" readonly="readonly" style="width: 12em;" /></h3>
    				<p class="bitian"><span>必填</span></p>
    			</div>
    			<ul class="lei_1">
    				<li>当前发布位置为<span id="typeName"></span>，资费为<span id="sysParam"></span></li>
    			</ul>
    			<div class="pore shouye222" id="type1">
                    <h3><img src="../img/star.png" />首页显示</h3>
                    <p class="bitian"><span>必填</span></p>
                    <div>
                        <div class="fir bigtu">
                            <img style="width:100%;" id="mainPic1" src="../img/lizi2.png" />
                        </div>
                        <div class="thi">
                            <div class="filePicker">上传(建议尺寸：750*300)</div>
                        </div>
                    </div>
                </div>
    			<div class="pore shouye" id="type2">
    				<h3><img src="../img/star.png" />首页显示</h3>
    				<p class="bitian"><span>必填</span></p>
    				<div>
    					<div id="yulan"><img id="mainPic2" src="../img/lizi1.png" /></div>
    					<div class="sec">
    						<div class="filePicker">上传(建议尺寸：300*210)</div>
    						<input type="text" value="" placeholder="请输入店铺名称" name="shopName" id="shopName"/>
    					</div>
    					<textarea placeholder="活动简介内容输入" name="summary" id="summary"></textarea>
    				</div>
    			</div>
    			
    			<div class="xiangqing">
    				<h3>详情页设置</h3>
    				<div>
    					<div class="danxuan">
    						<label>自动加载首页图片</label>
    						<input name="isInit" value="1" type="radio">
    					</div>
    					<div class="danxuan">
    						<label>不加载</label>
    						<input name="isInit" value="0" type="radio" checked="checked">
    					</div>
    				</div>
    				<div id="wenzhang_tu" class="filePicker1">上传图片</div>
    				<div id="wenzhang">
    					<textarea placeholder="活动简介内容添加" onpropertychange='this.style.posHeight=this.scrollHeight' onfocus='this.style.posHeight=this.scrollHeight'></textarea>
    				</div>
    			</div>
    			<div class="name">
    				<h3>命名此模板<input type="text" value="" name="actName" id="actName"/></h3>
    				<a class="w3" id="preview">预览</a><a class="w3 active" id="nextStep">下一步</a><a class="w4 tuisong">保存此模板</a>
    			</div>
    			<div class="submit">
    				<input id="duifang" value="" type="text" placeholder="输入接收对方账户名" />
    				<input value="推送" type="button" id="tsFun" />
    			</div>
			</form>
		</section>
        <script>
			/*单选按钮点击文字 相当于点击单选*/
		   $(document).ready(function(){
		       $("label").click(function(){
		          $(this).next("input").click(); 
		       });
		       $(".shuoming").click(function(){
		          
		       });
		       $(".border_b").click(function(){
		           
		           if($("#htmlStr").css("display") == "none"){
		               $("#htmlStr").show();
		               $(this).find("span").romoveClass("rightright");
		               $(this).find("span").addClass("toptop");
		           }else{
		               $("#htmlStr").hide();
		               $(this).find("span").romoveClass("toptop");
                       $(this).find("span").addClass("rightright");
		           }
		       });
		       $("#wenzhang textarea").on("keyup keydown", function(){
		           $(this).height(this.scrollHeight);
		       });
		   });
		</script>
        <script>
            /**
             * 发布
             */
            // type值范围：A1（轮播） B2（同城购活动）直接进入模板生成 下一步到模板使用页面
            // C D E F为频道活动 进入发布模式选择页面 然后下一步到模板生成页面 若为C D 则下一步到商品详情 其他的到模板使用页面
            var type = getVal("type") || "0";
            var num = type.substring(1,type.length);
            function removeStrHtml(){
                   alert();
            }
            $(function(){
                // 判断用户是否可以发布
                appcan.ajax({
                    type:"post",
                    url:host+"/canPublic.json?userId="+appcan.locStorage.getVal("userId"),
                    dataType:"json",
                    contentType: "application/json",
                    success : function(dataResult) {
                        if(dataResult.status == 0){
                            alert("该用户禁止发布，请联系管理员");
                            openUrl("../index.html","index");
                        }
                    }
                })
                
                // 获取模板生成说明
                appcan.ajax({
                    type:"post",
                    async:false,       
                    url:host+"/getSysPByKey.json?pKey=mbscy",
                    data:"",
                    dataType:"json",
                    contentType: "application/json",
                    success : function(dataResult) {
                        $("#htmlStr").html(dataResult.data.pValue);
                    }
                })
                
                // 获取金额
                appcan.ajax({
                   type:"get",     
                   url:host+"/getActFeeBy.json?actType=A1",
                   dataType:"json",
                   contentType: "application/json",
                   success : function(dataResult) {
                       var unit = "";
                       if(!!dataResult.data){
                           if(dataResult.data.unit == "day"){
                               $("#sysParam").text(dataResult.data.amount + "元/天");
                           }else if(dataResult.data.unit == "month"){
                               $("#sysParam").text(dataResult.data.amount + "元/月");
                           }else{
                               $("#sysParam").text("免费试用");  
                           }
                       }
                   }
               })
                
                $(".fir img").height($(".fir img").width()/3);
                
                // 初始化Web Uploader
                var uploader = WebUploader.create({
                    // 选完文件后，是否自动上传。
                    auto: true,
                    // swf文件路径
                    swf: '../js/webuploader/Uploader.swf',
                    // 文件接收服务端。
                    server: host+"/image/uploadImg.json?userId="+appcan.locStorage.getVal("userId"),
                    // 选择文件的按钮。可选。
                    // 内部根据当前运行是创建，可能是input元素，也可能是flash.
                    pick: '.filePicker',
                    duplicate : true,
                    compress :{
                        width: 750,
                        height: 300,
                        // 图片质量，只有type为`image/jpeg`的时候才有效。
                        quality: 90,
                        // 是否允许放大，如果想要生成小图的时候不失真，此选项应该设置为false.
                        allowMagnify: false,
                        // 是否允许裁剪。
                        crop: false,
                        // 是否保留头部meta信息。
                        preserveHeaders: true,
                        // 如果发现压缩后文件大小比原来还大，则使用原来图片
                        // 此属性可能会影响图片自动纠正功能
                        noCompressIfLarger: false,
                        // 单位字节，如果图片大小小于此值，不会采用压缩。
                        compressSize: 0
                    },
                    // 只允许选择图片文件。
                    accept: {
                        title: 'Images',
                        extensions: 'gif,jpg,jpeg,bmp,png',
                        mimeTypes: 'image/*'
                    }
                });
                
                // 文件上传成功，给item添加成功class, 用样式标记上传成功。
                uploader.on('uploadSuccess', function(file, dataResult) {
                    if($("#type1").is(":visible")){
                        $("#mainPic1").attr("src", hostIp+dataResult.data.imgUrl);
                    }else{
                        $("#mainPic2").attr("src", hostIp+dataResult.data.imgUrl);
                    }
                    $(".mainPic").val(dataResult.data.imgUrl);
                });
                
                uploader.on('uploadError', function(file, reason){
                    if(reason=="F_EXCEED_SIZE"){
                        alert("文件大小不能超过2M");
                    }
                })
                
                // 文件上传过程中创建进度条实时显示。
                uploader.on( 'uploadProgress', function( file, percentage ) {
                    var percent = (percentage * 100).toFixed(2);
                    if(percent!=100){
                        $(".filePicker .webuploader-pick").html("正在上传，进度"+percent+"%");
                        $(".filePicker input[name='file']").attr("disabled","disabled");
                    }else{
                        $(".filePicker .webuploader-pick").html("上传(建议尺寸：300*210)");
                        $(".filePicker input[name='file']").removeAttr("disabled");
                    }
                });
                
                // 初始化Web Uploader
                var uploader1 = WebUploader.create({
                    // 选完文件后，是否自动上传。
                    auto: true,
                    // swf文件路径
                    swf: '../js/webuploader/Uploader.swf',
                    // 文件接收服务端。
                    server: host+"/image/uploadImg.json?userId="+appcan.locStorage.getVal("userId"),
                    // 选择文件的按钮。可选。
                    // 内部根据当前运行是创建，可能是input元素，也可能是flash.
                    pick: '.filePicker1',
                    duplicate : true,
                    compress :{
                        width: 750,
                        height: 300,
                        // 图片质量，只有type为`image/jpeg`的时候才有效。
                        quality: 90,
                        // 是否允许放大，如果想要生成小图的时候不失真，此选项应该设置为false.
                        allowMagnify: false,
                        // 是否允许裁剪。
                        crop: false,
                        // 是否保留头部meta信息。
                        preserveHeaders: true,
                        // 如果发现压缩后文件大小比原来还大，则使用原来图片
                        // 此属性可能会影响图片自动纠正功能
                        noCompressIfLarger: false,
                        // 单位字节，如果图片大小小于此值，不会采用压缩。
                        compressSize: 0
                    },
                    // 只允许选择图片文件。
                    accept: {
                        title: 'Images',
                        extensions: 'gif,jpg,jpeg,bmp,png',
                        mimeTypes: 'image/*'
                    }
                });
                
                // 文件上传成功，给item添加成功class, 用样式标记上传成功。
                uploader1.on('uploadSuccess', function(file, dataResult) {
                    var str = '<div class="childStr" style="position: relative;width:100%"><img src="'+hostIp+dataResult.data.imgUrl+'" style="position:relative;"/><div class="opa" style="padding-left: 2.5em;padding-right: 0.3125em;"><img class="opaimg" src="../img/quxiao.png">删除</div></div>';
                    str += '<div clss="childStr" style="position: relative;padding-top:0.5em;width:100%"><textarea placeholder="活动简介内容添加" onpropertychange="this.style.posHeight=this.scrollHeight" onfocus="this.style.posHeight=this.scrollHeight"></textarea><div class="opa" style="padding-left: 2.5em;padding-right: 0.3125em;"><img class="opaimg" src="../img/quxiao.png">删除</div></div>';
                    $("#wenzhang").append(str);
                    $("#wenzhang textarea").blur(function(){
                        $(this).html($(this).val());
                    })
                    $("#wenzhang textarea").change(function(){
                        $(this).css("height", $(this)[0].scrollHeight);
                    })
                    //
                    $(".opa").click(function(){
                        $(this).parent().remove();
                    })
                });
                // 文件上传过程中创建进度条实时显示。
                uploader.on( 'uploadProgress', function( file, percentage ) {
                    var percent = (percentage * 100).toFixed(2);
                    if(percent!=100){
                        $(".filePicker1 .webuploader-pick").html("正在上传，进度"+perccent+"%");
                        $(".filePicker1 input[name='file']").attr("disabled","disabled");
                    }else{
                        $(".filePicker1 .webuploader-pick").html("上传图片");
                        $(".filePicker1 input[name='file']").removeAttr("disabled");
                    }
                });
                
                if(!!getVal("actId")){
                    // 编辑页面获取数据
                    appcan.ajax({
                        type:"post",
                        url:host+"/getActive.json?actId="+getVal("actId"),
                        dataType:"json",
                        async:false,    
                        contentType: "application/json",
                        success : function(dataResult) {
                            if(!!dataResult.data){
                                var data = dataResult.data;
                                type = data.actType;
                                $("#code").val(data.actType);
                                $(".mainPic").val(data.mainPic);
                                $("#mainPic1").attr("src", hostIp+data.mainPic);
                                $("#mainPic2").attr("src", hostIp+data.mainPic);
                                $("#shopName").val(data.shopName);
                                $("#summary").val(data.summary);
                                $("input:radio[value='"+data.isInit+"']").attr('checked','true');
                                $("#wenzhang").html(data.detailContent);
                                $("#actName").val(data.actName);
                                num = type.substring(1,type.length);
                                $(".opa").click(function(){
                                    $(this).parent().remove();
                                })
                            }
                        }
                    })
                }
                
                // 若类型传参错误 则返回上一个页面
                if(type == "0"){
                    appcan.window.close(-1); 
                    return false;
                }
                
                switch(type){
                    case "A1":
                        $("#typeName").text("名优活动");
                        break;
                    case "B2":
                        $("#typeName").text("同城购活动");
                        break;
                    case "C1":
                        $(".xiangqing").hide();
                        $("#typeName").text("超市模块");
                        break;
                    case "D1":
                        $(".xiangqing").hide();
                        $("#typeName").text("母婴模块");
                        break;
                    case "E1":
                        $("#typeName").text("车辆模块");
                        break;
                    case "F1":
                        $("#typeName").text("房产模块");
                        break;
                    case "C2":
                        $(".xiangqing").hide();
                        $("#typeName").text("超市模块");
                        break;
                    case "D2":
                        $(".xiangqing").hide();
                        $("#typeName").text("母婴模块");
                        break;
                    case "E2":
                        $("#typeName").text("车辆模块");
                        break;
                    case "F2":
                        $("#typeName").text("房产模块");
                        break;
                }
                
                //类型为1 隐藏类型2
                //位置代码
                //$("#typeNum").text(num);
                $("#code").val(type);
                if(num == 1){
                    $("#type1").show();
                    $("#type2").hide();
                }else{
                    $("#type1").hide();
                    $("#type2").show();
                }
                
                // 预览
                $("#preview").click(function(){
                    saveAct("preview");
                })
                
                // 下一步
                $("#nextStep").click(function(){
                    saveAct("nextStep");
                })
                
                $(".tuisong").click(function(){
                   saveAct("save");
                })
                
                // 异步保存当前页面信息
                function saveAct(obj){
                    // 数据校验
                    if($.trim($("#code").val()).length == 0){
                        alert("位置代码不能为空");
                        return false;
                    }
                    if($.trim($(".mainPic").val()).length == 0){
                        alert("上传活动图片");
                        return false;
                    }
                    if($("#type2").is(':visible') && $.trim($("#shopName").val()).length == 0){
                        alert("店铺名称不能为空")
                        return false;
                    }
                    if($("#type2").is(':visible') && $.trim($("#summary").val()).length == 0){
                        alert("活动简介不能为空");
                        return false;
                    }
                    
                    var detailContent = $("#wenzhang").html();
                    var baseParam = {
                        id : getVal("actId"),
                        userId : appcan.locStorage.getVal("userId"),
                        actType: type,
                        addName: appcan.locStorage.getVal("ipcity"),
                        detailContent: detailContent
                    };
                    var param = $("#actForm").serializeJson(baseParam);
                    var result = null;
                    appcan.ajax({
                       type:"post",
                       async:false,       
                       url:host+"/saveAct.json",
                       data:param,
                       dataType:"json",
                       contentType: "application/json",
                       success : function(dataResult) {
                           console.log(dataResult);
                           if(dataResult.status==-1){
                               alert("模板名称重复，请重新输入！");
                           }else{
                                result = dataResult;
                                if(obj == "preview"){
                                   if(result.status > 0){
                                        openUrl("../page/info.html?actId="+result.data,"actInfo");
                                   }
                                }else if(obj == "save"){
                                    alert("操作成功");
                                }else {
                                   if(result.status > 0){
                                        // 只有超市 婴育
                                        openUrl("moban_shiyong.html?type="+type+"&actId="+result.data,"moban_shiyong");
                                        //if(type=="C1" || type=="C2" || type=="D1" || type=="D2"){
                                            //openUrl("good_edit.html?type="+type+"&actId="+result.data,"good_edit");
                                        //}else{
                                            //openUrl("moban_shiyong.html?type="+type+"&actId="+result.data,"moban_shiyong");
                                        //}
                                   }
                               }
                           }
                       }
                   })
                }
                
                // 推送
                $("#tsFun").click(function(){
                   if($("#duifang").val().length == 0){
                       alert("输入接收对方账户名");
                   }else{
                       appcan.ajax({
                            type:"post",
                            url:host+"/checkUser.json?userName="+$("#duifang").val(),
                            dataType:"json",
                            contentType: "application/json",
                            success : function(dataResult1) {
                                if(dataResult1.status == 0){
                                    alert(dataResult1.msg);
                                }else{
                                    // 数据校验
                                    if($.trim($("#code").val()).length == 0){
                                        alert("位置代码不能为空")
                                        return false;
                                    }
                                    if($.trim($(".mainPic").val()).length == 0){
                                        alert("上传活动图片")
                                        return false;
                                    }
                                    if($("#type2").is(':visible') && $.trim($("#shopName").val()).length == 0){
                                        alert("店铺名称不能为空")
                                        return false;
                                    }
                                    if($("#type2").is(':visible') && $.trim($("#summary").val()).length == 0){
                                        alert("活动简介不能为空")
                                        return false;
                                    }
                                    var detailContent = $("#wenzhang").html();
                                    var baseParam = {
                                        userId : appcan.locStorage.getVal("userId"),
                                        actType: type,
                                        addName: appcan.locStorage.getVal("ipcity"),
                                        detailContent: detailContent
                                    };
                                    var param = $("#actForm").serializeJson(baseParam);
                                    var result = null;
                                    appcan.ajax({
                                       type:"post",
                                       async:false,       
                                       url:host+"/saveAct.json",
                                       data:param,
                                       dataType:"json",
                                       contentType: "application/json",
                                       success : function(dataResult) {
                                            result = dataResult;
                                            appcan.ajax({
                                                type:"post",
                                                url:host+"/operateAct.json?fromActId="+dataResult.data
                                                +"&userId="+dataResult1.data.id+"&fromUserId="+appcan.locStorage.getVal("userId")
                                                +"&logType=5",
                                                dataType:"json",
                                                contentType: "application/json",
                                                success : function(dataResult) {
                                                    alert("操作成功")
                                                    openUrl("../index.html","index");
                                                }
                                            })
                                       }
                                   })
                                }
                            }
                        })
                   }
               })
            })
        </script>
	</body>

</html>