<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="description" content="" />
        <meta name="keywords" content="" />
        <meta name="author" content="Flying hormone" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta charset="UTF-8">
        <link rel="stylesheet" href="../css/media.css" />
        <link rel="stylesheet" href="../css/mui.min.css" />
        <link rel="stylesheet" href="../css/head_foot.css" />
        <script type="text/javascript" src="../js/jquery-1.9.1.js"></script>
        <script type="text/javascript" src="../js/jquery.Query.js" ></script>
        <script type="text/javascript" src="../js/jquery-cookie.js"></script>
        <script type="text/javascript" src="../js/mui.min.js"></script>
        <script type="text/javascript" src="../js/appcan.js"></script>
        <script type="text/javascript" src="../js/appcan.control.js"></script>
        <script type="text/javascript" src="../js/common.js" ></script>
        <link rel="stylesheet" href="../js/webuploader/webuploader.css" />
        <script type="text/javascript" src="../js/webuploader/webuploader.js" ></script>
		<title>模版生成</title>
		<style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                -moz-box-sizing: border-box;
                -webkit-box-sizing: border-box;
            }
            
            body {
                width: 100%;
                overflow-x: hidden;
                font-family: "微软雅黑";
                background: #f8f8f8;
                font-size: 1em;
                /*padding-bottom: 3.875em;*/
            }
            
            h1,
            h2,
            h3,
            h4,
            h5,
            h6 {
                font-weight: normal;
                margin: 0;
            }
            
            p {
                margin: 0;
            }
            
            ul,
            li,
            ol {
                list-style: none;
            }
            
            section {
                background: #fff;
                margin-top: 0.625em;
            }
            
            section div {
                height: auto;
                background: #fff;
                overflow: hidden;
                clear: both;
            }
            
            section h3 {
                font-size: 0.8em;
                font-weight: bold;
                height: 3.125em;
                line-height: 3.125em;
                float: left;
                text-indent: 1em;
            }
            
            section p {
                float: right;
                height: 3.125em;
                line-height: 3.125em;
            }
            
            section p span {
                margin-top: 0.1875em;
                margin-right: 0.625em;
            }
            
            section p a {
                color: #ff3366;
                border: 1px solid #ff3366;
                padding: 0 0.625em;
                border-radius: 0.3125em;
                margin-right: 0.3125em;
            }
            
            section i ,.lei_1 li{
                font-style: normal;
                font-weight: normal;
                font-size: 0.6em;
                color: #cd4400;
            }
            
            section li {
                height: 3.125em;
                line-height: 3.125em;
                clear: both;
            }
            
            section h4 {
                color: #666;
                line-height: 3.125em;
                float: left;
                margin-left: 1.25em;
                margin-left: 4em;
                font-size: 0.8em;
            }
            
            li p {
                float: right;
            }
            
            section li a {
                color: #ccc;
                border: 1px solid #ccc;
                padding: 0 0.625em;
                border-radius: 0.3125em;
            }
            
            .shuoming h3 {
                color: #999;
            }
            
            .shuoming li {
                padding: 0 1em;
                line-height: 1.25em;
                height: auto;
                overflow: hidden;
                color: #666;
            }
            
            @media screen and (max-width: 360px) {
                body {
                    background-color: lightblue;
                }
                section.sec_3 div.tu_tu i {
                    padding: 0;
                }
                section.sec_3 div.tu_tu span {
                    margin: 0;
                }
            }
            textarea{ height: 7.5em; margin: 0 4%; width: 92%; font-size: 1em; line-height: 1.2em;}
            .upload h3{ font-style: normal; font-weight: normal; width: 100%; color: #666;}
            .upload h3 input[type=text]{ width: auto; display: inline; height: 1.875em; margin-left: 0.625em;     font-size: 1em;
    margin-bottom: 0;
    line-height: normal;}
            .pore{ position: relative;}
            .bitian{ position: absolute; right: 0.625em; top: 0;}
            .lei_1{ padding-top: 0.625em; background: #f8f8f8;}
            .lei_1 li{ text-align: right; margin-right: 1em; line-height: 1.25em; height: 1.875em;}
            .shouye img{ height: 0.625em;}
            .shouye>div .fir,.shouye>div .sec{float: left; clear: none; padding: 0 0.5em;}
            .shouye>div div img{ width: 100%; height: auto;}
            .shouye>div div p{ float: none; line-height: 1.25em; color: #666; }
            .shouye>div div a{ line-height:1.5em; display: block; width: 100%; text-align: center ; background: #ff3366; color: #fff;}
            .shouye .fir{ width: 60%;}
            .shouye .sec{ width: 40%; position: relative; height: 100%;}
            .xiangqing>div div{  float: left; clear: none; color: #666; padding-left: 0.5em;}
            .name{ padding-bottom: 1.25em;}
            .name a{ font-size: 1em; line-height: 1.2em; padding: 2px 0; display: block; float: left; background: #fff; color: #ff3366; border: 1px solid #FF3366; margin:0 3%; text-align: center; border-radius: 0.3125em;}
            .name a.active{ color: #fff; background: #ff3366;}
            .name a.w3{ width: 25%;}
            .name a.w4{ width: 30%;}
            .submit input:first-child{ font-size:1em; width: 60%; float: left; margin-left: 2.5%; height: 1.875em; line-height: 1.875em;}
            .submit input:last-child{ font-size:1em; width: 25%; margin: 0 5%;  height: 1.875em; line-height: 1.875em; padding: 0; background: #ff3366; border-color: #ff3366;}
            .mui-checkbox input[type=checkbox]:before, .mui-radio input[type=radio]:before{ font-size: 1.25em; line-height: 1.875em; color: #666!important;}
            #upload0{ display: none ;}
			.mui-checkbox input[type=checkbox]:before, .mui-radio input[type=radio]:before{
                line-height: 0;
            }
            .mui-checkbox.mui-left input[type=checkbox], .mui-radio.mui-left input[type=radio]{
                top: 20px
            }
            .mui-checkbox label, .mui-radio label{
                font-size: 0.8em;
            }
			.danxuan{
                margin-bottom: 1em;
            }
            .danxuan label{
                font-size: 0.8em;
                line-height: 1.2em;
            }
            .danxuan input{
                float: left;
                height: 1.5em;
                width: 1.5em;
                font-size: 0.5em;
                margin:0 0.5em;
                margin-top: 0.2em
            }
            .webuploader-pick{
            line-height:1.5em; display: block; width: 100%; text-align: center ; 
            background: #ff3366; color: #fff;padding: 0 0;
            }
            .rightright{
                margin-top: 1em;
            }
        </style>
	</head>

	<body>
		<header>
			<a><span class="leftleft"></span></a>
			<h1>模版生成</h1>
			<a class="xiaoxi6" href="javascript:;" onclick="openUrl('daizuo.html','daizuo')">请人代做</a>
		</header>
		<section class="shuoming">
			<div>
				<h3>说明</h3>
				<p><span class="rightright"></span></p>
			</div>
			<ul id="htmlStr"></ul>
		</section>
		<section class="upload">
		    <form id="actForm">
		        <input type="hidden" name="mainPic" class="mainPic" value="" />
    			<div class="pore">
    				<h3>输入位置代码<input id="code" type="text" value="" placeholder="输入位置代码" readonly="readonly" style="width: 12em;" /></h3>
    				<p class="bitian"><span>必填</span></p>
    				<h3>所在市区域<input id="region" type="text" value="" placeholder="输入所在市区域" style="width: 12em;"/></h3>
    				<p class="bitian"><span>必填</span></p>
    			</div>
    			<ul class="lei_1">
    				<li>当前发布位置为<span id="typeName"></span>，样式类型为<span id="typeNum"></span>，资费为<span id="sysParam"></span></li>
    			</ul>
    			<div class="pore shouye" id="type1">
    				<h3><img src="../img/star.png" />样式1：首页显示</h3>
    				<p class="bitian"><span>必填</span></p>
    				<div>
    					<div id="yulan" class="fir"><img id="mainPic" src="../img/img_8.png" /></div>
    					<div class="sec">
    						<p>首页详情页页头图片300*100</p>
    						<div id="filePicker">上传</div>
    					</div>
    				</div>
    			</div>
    			<div class="pore shouye" id="type2">
    				<h3><img src="../img/star.png" />样式2：首页显示</h3>
    				<p class="bitian"><span>必填</span></p>
    				<textarea placeholder="活动简介内容输入" name="summary" id="summary"></textarea>
    			</div>
    			
    			<div class="xiangqing">
    				<h3>样式1样式2通用详情页</h3>
    				<div>
    					<div class="danxuan">
    						<label>自动加载样式1首页图片</label>
    						<input name="isInit" value="1" type="radio" checked="">
    					</div>
    					<div class="danxuan">
    						<label>不加载</label>
    						<input name="isInit" value="0" type="radio">
    					</div>
    				</div>
    				<div>
    					<textarea placeholder="活动简介内容添加" name="detailSummary" id="detailSummary"></textarea>
    					<textarea placeholder="附文本编辑器" name="detailContent" id="detailContent"></textarea>
    				</div>
    			</div>
    			<div class="name">
    				<h3>命名此模板<input type="text" value="" placeholder="A1" name="actName"/></h3>
    				<a class="w3" id="preview">预览</a><a class="w3 active" id="nextStep">下一步</a><a class="w4">推送此模版</a>
    			</div>
    			<div class="submit">
    				<input value="" type="text" placeholder="输入接收对方账户名" />
    				<input value="推送" type="submit"  />
    			</div>
			</form>
		</section>
        <script>
			/*单选按钮点击文字 相当于点击单选*/
		   $(document).ready(function(){
		       $("label").click(function(){
		          $(this).next("input").click(); 
		       });
		   });
		</script>
        <script>
            /**
             * 发布
             */
            // type值范围：A1（轮播） B2（同城购活动）直接进入模板生成 下一步到模板使用页面
            // C D E F为频道活动 进入发布模式选择页面 然后下一步到模板生成页面 若为C D 则下一步到商品详情 其他的到模板使用页面
            var type = getVal("type") || "0";
            var num = type.substring(1,type.length);
            $(function(){
                // 获取模板生成说明
                appcan.ajax({
                    type:"post",
                    async:false,       
                    url:host+"/getSysPByKey.json?pKey=mbscy",
                    data:"",
                    dataType:"json",
                    contentType: "application/json",
                    success : function(dataResult) {
                        $("#htmlStr").html(dataResult.data.pValue);
                    }
                })
                
                // 获取金额
                appcan.ajax({
                   type:"get",     
                   url:host+"/getActFeeBy.json?actType=A1",
                   dataType:"json",
                   contentType: "application/json",
                   success : function(dataResult) {
                       var unit = "";
                       if(!!dataResult.data){
                           if(dataResult.data.unit == "day"){
                               $("#sysParam").text(dataResult.data.amount + "元/天");
                           }else if(dataResult.data.unit == "month"){
                               $("#sysParam").text(dataResult.data.amount + "元/月");
                           }else{
                               $("#sysParam").text("免费试用");  
                           }
                       }
                   }
               })
                
                $(".fir img").height($(".fir img").width()/3);
                
                // 初始化Web Uploader
                var uploader = WebUploader.create({
                    // 选完文件后，是否自动上传。
                    auto: true,
                    // swf文件路径
                    swf: '../js/webuploader/Uploader.swf',
                    // 文件接收服务端。
                    server: host+"/image/uploadImg.json?userId="+appcan.locStorage.getVal("userId"),
                    // 选择文件的按钮。可选。
                    // 内部根据当前运行是创建，可能是input元素，也可能是flash.
                    pick: '#filePicker',
                    // 只允许选择图片文件。
                    accept: {
                        title: 'Images',
                        extensions: 'gif,jpg,jpeg,bmp,png',
                        mimeTypes: 'image/*'
                    }
                });
                
                // 文件上传成功，给item添加成功class, 用样式标记上传成功。
                uploader.on('uploadSuccess', function(file, dataResult) {
                    $("#mainPic").attr("src", hostIp+dataResult.data.imgUrl);
                    $(".mainPic").val(dataResult.data.imgUrl);
                });
                
                // 若类型传参错误 则返回上一个页面
                if(type == "0"){
                    appcan.window.close(-1); 
                    return false;
                }
                
                switch(type){
                    case "A1":
                        $("#typeName").text("名优活动");
                        break;
                    case "B2":
                        $("#typeName").text("同城购活动");
                        break;
                    case "C1":
                        $("#typeName").text("超市模块");
                        break;
                    case "D1":
                        $("#typeName").text("孕婴模块");
                        break;
                    case "E1":
                        $("#typeName").text("车辆模块");
                        break;
                    case "F1":
                        $("#typeName").text("房产模块");
                        break;
                    case "C2":
                        $("#typeName").text("超市模块");
                        break;
                    case "D2":
                        $("#typeName").text("婴育模块");
                        break;
                    case "E2":
                        $("#typeName").text("车辆模块");
                        break;
                    case "F2":
                        $("#typeName").text("房产模块");
                        break;
                }
                
                //类型为1 隐藏类型2
                //位置代码
                $("#typeNum").text(num);
                $("#code").val(type);
                if(num == 1){
                    $("#type2").hide();
                }
                
                // 预览
                $("#preview").click(function(){
                    saveAct("preview");
                })
                
                // 下一步
                $("#nextStep").click(function(){
                    saveAct("nextStep");
                })
                
                // 异步保存当前页面信息
                function saveAct(obj){
                    // 数据校验
                    if($.trim($("#code").val()).length == 0){
                        appcan.window.alert({
                            title:'提示',
                            content:'位置代码不能为空',
                            buttons:'确定'
                        });
                        return false;
                    }
                    if($.trim($("#region").val()).length == 0){
                        appcan.window.alert({
                            title:'提示',
                            content:'所在市区域不能为空',
                            buttons:'确定'
                        });
                        return false;
                    }
                    if($.trim($(".mainPic").val()).length == 0){
                        appcan.window.alert({
                            title:'提示',
                            content:'上传活动图片',
                            buttons:'确定'
                        });
                        return false;
                    }
                    if($("#type2").is(':visible') && $.trim($("#summary").val()).length == 0){
                        appcan.window.alert({
                            title:'提示',
                            content:'活动简介不能为空',
                            buttons:'确定'
                        });
                        return false;
                    }
                    if($.trim($("#detailSummary").val()).length == 0){
                        appcan.window.alert({
                            title:'提示',
                            content:'活动简介不能为空',
                            buttons:'确定'
                        });
                        return false;
                    }
                    
                    var baseParam = {
                        userId : appcan.locStorage.getVal("userId"),
                        actType: type,
                        region: $("#region").val(),
                        addName: appcan.locStorage.getVal("ipcity")
                    };
                    var param = $("#actForm").serializeJson(baseParam);
                    var result = null;
                    appcan.ajax({
                       type:"post",
                       async:false,       
                       url:host+"/saveAct.json",
                       data:param,
                       dataType:"json",
                       contentType: "application/json",
                       success : function(dataResult) {
                            result = dataResult;
                            if(obj == "preview"){
                               if(result.status > 0){
                                    openUrl("../page/info.html?actId="+result.data,"actInfo");
                               }
                            }else{
                               if(result.status > 0){
                                    // 只有超市 婴育
                                    if(type=="C1" || type=="C2" || type=="D1" || type=="D2"){
                                        openUrl("good_edit.html?type="+type+"&actId="+result.data,"good_edit");
                                    }else{
                                        openUrl("moban_shiyong.html?type="+type+"&actId="+result.data,"moban_shiyong");
                                    }
                               }
                           }
                       }
                   })
                }
            })
            
            // 上传图片
            function uploadImg(){
                var data = {
                    min:1,
                    max:1,
                    quality:0.8,
                    detailedInfo:true
                }
                uexImage.openPicker(data,function(error,info){
                    //上传图片
                    var baseParam = {
                        userId : appcan.locStorage.getVal("userId"),
                        file : info.detailedImageInfo
                    };
                    var param = JSON.stringify(baseParam);
                    appcan.ajax({
                       type:"post",      
                       url:host+"/image/uploadImg.json",
                       data:param,
                       dataType:"json",
                       contentType: "application/json",
                       success : function(dataResult) {
                            $("mainPic").attr("src", dataResult.imgUrl);
                       }
                   })
                });
            }
        </script>
	</body>

</html>