<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="description" content="" />
        <meta name="keywords" content="" />
        <meta name="author" content="Flying hormone" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta charset="UTF-8">
        <link rel="stylesheet" href="../css/media.css" />
        <link rel="stylesheet" href="../css/mui.min.css" />
        <link rel="stylesheet" href="../css/head_foot.css" />
        <script type="text/javascript" src="../js/jquery-1.9.1.js"></script>
        <script type="text/javascript" src="../js/jquery.Query.js" ></script>
        <script type="text/javascript" src="../js/jquery-cookie.js"></script>
        <script type="text/javascript" src="../js/mui.min.js"></script>
        <script type="text/javascript" src="../js/appcan.js"></script>
        <script type="text/javascript" src="../js/appcan.control.js"></script>
        <script type="text/javascript" src="../js/common.js" ></script>
		<title>模版生成</title>
		<style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                -moz-box-sizing: border-box;
                -webkit-box-sizing: border-box;
            }
            
            body {
                width: 100%;
                overflow-x: hidden;
                font-family: "微软雅黑";
                background: #f8f8f8;
                font-size: 1em;
                /*padding-bottom: 3.875em;*/
            }
            
            h1,
            h2,
            h3,
            h4,
            h5,
            h6 {
                font-weight: normal;
                margin: 0;
            }
            
            p {
                margin: 0;
            }
            
            ul,
            li,
            ol {
                list-style: none;
            }
            
            section {
                background: #fff;
                margin-top: 0.625em;
            }
            
            section div {
                height: auto;
                background: #fff;
                overflow: hidden;
                clear: both;
            }
            
            section h3 {
                font-size: 0.8em;
                font-weight: bold;
                height: 3.125em;
                line-height: 3.125em;
                float: left;
                text-indent: 1em;
            }
            
            section p {
                float: right;
                height: 3.125em;
                line-height: 3.125em;
            }
            
            section p span {
                margin-top: 0.1875em;
                margin-right: 0.625em;
            }
            
            section p a {
                color: #ff3366;
                border: 1px solid #ff3366;
                padding: 0 0.625em;
                border-radius: 0.3125em;
                margin-right: 0.3125em;
            }
            
            section i ,.lei_1 li{
                font-style: normal;
                font-weight: normal;
                font-size: 0.6em;
                color: #cd4400;
            }
            
            section li {
                height: 3.125em;
                line-height: 3.125em;
                clear: both;
            }
            
            section h4 {
                color: #666;
                line-height: 3.125em;
                float: left;
                margin-left: 1.25em;
                margin-left: 4em;
                font-size: 0.8em;
            }
            
            li p {
                float: right;
            }
            
            section li a {
                color: #ccc;
                border: 1px solid #ccc;
                padding: 0 0.625em;
                border-radius: 0.3125em;
            }
            
            .shuoming h3 {
                color: #999;
            }
            
            .shuoming li {
                padding: 0 1em;
                line-height: 1.25em;
                height: auto;
                overflow: hidden;
                color: #666;
            }
            
            @media screen and (max-width: 360px) {
                body {
                    background-color: lightblue;
                }
                section.sec_3 div.tu_tu i {
                    padding: 0;
                }
                section.sec_3 div.tu_tu span {
                    margin: 0;
                }
            }
            textarea{ height: 7.5em; margin: 0 4%; width: 92%;}
            .upload h3{ font-style: normal; font-weight: normal; width: 100%; color: #666;}
            .upload h3 input[type=text]{ width: auto; display: inline; height: 1.875em; margin-left: 0.625em;     font-size: 1em;
    margin-bottom: 0;
    line-height: normal;}
            .pore{ position: relative;}
            .bitian{ position: absolute; right: 0.625em; top: 0;}
            .lei_1{ padding-top: 0.625em; background: #f8f8f8;}
            .lei_1 li{ text-align: right; margin-right: 1em; line-height: 1.25em; height: 1.875em;}
            .shouye img{ height: 0.625em;}
            .shouye>div div{float: left; clear: none; padding: 0 1em;}
            .shouye>div div img{ width: 100%; height: auto;}
            .shouye>div div p{ float: none; line-height: 1.25em; color: #666; }
            .shouye>div div a{ line-height:1.5em; display: block; width: 100%; text-align: center ; background: #ff3366; color: #fff;}
            .shouye .fir{ width: 60%;}
            .shouye .sec{ width: 40%; position: relative; height: 100%;}
            .xiangqing>div div{ width: 50%; float: left; clear: none; color: #666;}
            .name{ padding-bottom: 1.25em;}
            .name a{ font-size: 1em; line-height: 1.2em; padding: 2px 0; display: block; float: left; background: #fff; color: #ff3366; border: 1px solid #FF3366; margin:0 3%; text-align: center; border-radius: 0.3125em;}
            .name a.active{ color: #fff; background: #ff3366;}
            .name a.w3{ width: 25%;}
            .name a.w4{ width: 30%;}
            .submit input:first-child{ font-size:1em; width: 60%; float: left; margin-left: 2.5%; height: 1.875em; line-height: 1.875em;}
            .submit input:last-child{ font-size:1em; width: 25%; margin: 0 5%;  height: 1.875em; line-height: 1.875em; padding: 0; background: #ff3366; border-color: #ff3366;}
            .mui-checkbox input[type=checkbox]:before, .mui-radio input[type=radio]:before{ font-size: 1.25em; line-height: 1.875em; color: #666!important;}
            #upload0{ display: none ;}
        </style>
	</head>

	<body>
		<header>
			<a class=""><span class="mui-icon mui-icon-back"></span></a>
			<h1>模版生成</h1>
			<a class="xiaoxi6" href="javascript:;" onclick="openUrl('daizuo.html','daizuo')">请人代做</a>
		</header>
		<section class="shuoming">
			<div>
				<h3>说明</h3>
				<p><span class="mui-icon mui-icon-arrowup"></span></p>
			</div>
			<ul>
				<li><i>发布说明：</i>发布内容举办地必须为本地。主要包括店庆、开业、店面升级，节目促销等优惠活动。</li>
				<li><i>资费说明：</i>样式1为收费展示(例如首页轮播大图、四大模块大图部分)展示费用每天80元。样式2为免费展示(例如同城购四大模块非大图部分)</li>
				<li><i>请人代做：</i>每次40元。</li>
				<li><i>位置代码：</i>生成规则轮播图A同城购B四大模块超市C婴孕D车辆E房产F+样式1为数字1样式2为数字2。(样式1指首导航页是大图的形式，样式2指导航页是左侧店铺图片+右侧店铺名称和简短活动说明)例如轮播图位置代码为A1,A指轮播图位置为轮播图，1指样式1。</li>
			</ul>
		</section>
		<section class="upload">
		    <form id="imgForm" style="display: none;">
                <input id="userId" name="userId" value="" type="hidden"/>
                <input id="upload0" type="file" name="file" accept="image/jpeg,image/bmp" />
            </form>
		    <form id="actForm">
		        <input type="hidden" name="mainPic" class="mainPic" value="" />
    			<div class="pore">
    				<h3>输入位置代码<input id="code" name="actType" type="text" value="" placeholder="输入位置代码" readonly="readonly"/></h3>
    				<p class="bitian"><span>必填</span></p>
    			</div>
    			<ul class="lei_1">
    				<li>当前发布位置为<span id="typeName"></span>，样式类型为<span id="typeNum"></span>，资费原价3000/月，1500月</li>
    			</ul>
    			<div class="pore shouye" id="type1">
    				<h3><img src="../img/star.png" />样式1：首页显示</h3>
    				<p class="bitian"><span>必填</span></p>
    				<div>
    					<div id="yulan" class="fir"><img id="mainPic" src="../img/img_8.png" /></div>
    					<div class="sec">
    						<p>首页详情页页头图片300*100</p>
    						<a>上传</a>
    					</div>
    				</div>
    			</div>
    			<div class="pore shouye" id="type2">
    				<h3><img src="../img/star.png" />样式2：首页显示</h3>
    				<p class="bitian"><span>必填</span></p>
    				<textarea placeholder="活动简介内容输入" name="summary" id="summary"></textarea>
    			</div>
    			
    			<div class="xiangqing">
    				<h3>样式1样式2通用详情页</h3>
    				<div>
    					<div class="mui-input-row mui-radio mui-left">
    						<label>自动加载样式1首页图片</label>
    						<input name="isInit" value="1" type="radio" checked="">
    					</div>
    					<div class="mui-input-row mui-radio mui-left">
    						<label>不加载</label>
    						<input name="isInit" value="0" type="radio">
    					</div>
    				</div>
    				<div>
    					<textarea placeholder="活动简介内容添加" name="detailSummary" id="detailSummary"></textarea>
    					<textarea placeholder="附文本编辑器" name="detailContent" id="detailContent"></textarea>
    				</div>
    			</div>
    			<div class="name">
    				<h3>命名此模板<input type="text" value="" placeholder="A1" name="actName"/></h3>
    				<a class="w3" id="preview">预览</a><a class="w3 active" id="nextStep">下一步</a><a class="w4">推送此模版</a>
    			</div>
    			<div class="submit">
    				<input value="" type="text" placeholder="输入接收对方账户名" />
    				<input value="推送" type="submit"  />
    			</div>
			</form>
		</section>
        <script>
            /**
             * 发布
             */
            // type值范围：A1（轮播） B2（同城购活动）直接进入模板生成 下一步到模板使用页面
            // C D E F为频道活动 进入发布模式选择页面 然后下一步到模板生成页面 若为C D 则下一步到商品详情 其他的到模板使用页面
            var type = getVal("type") || "0";
            var num = type.substring(1,type.length);
            $(function(){
                
                $(".fir img").height($(".fir img").width()/3);
                $("#userId").val(appcan.locStorage.getVal("userId"));
                $(".sec a").click(function(){
                    fileSelect(yulan,'#upload'+0);
                });
                
                function fileSelect(id1,id2) {
                    $(id2).click(); 
                    $(function() {
                    $(id2).one("change",function(e) {
                    var file = e.target.files[0];
                    console.log(file.size/1024);
                    console.log(file);
                    if(file.size/1024 > 1024){
                        alert("请选择1M大小 以下的图片");
                    }else{
                        preview1(file);
                    }
                    })
                    })
                function preview1(file) {
                     var formData = new FormData($( "#imgForm" )[0]);
           $.ajax({  
              url: host+"/image/uploadImg.json",
              type: 'POST',  
                  data: formData,  
                  async: false,  
                  cache: false,  
                  contentType: false,  
                  processData: false,  
                  success: function (returndata) {  
                      $(".mainPic").val(returndata.data.imgUrl);
                  },  
                  error: function (returndata) {  
                      
                  }  
             });  
                    var img = new Image();
                    var url = img.src = URL.createObjectURL(file);
                    var $img = $(img);
                    
                    img.onload = function() {
                    URL.revokeObjectURL(url);
                    $(id1).empty();
                    $(id1).append($img);
                    $(".fir img").height($(".fir img").width()/3);
                    }
                    }
                function preview2(file) {
                    var reader = new FileReader()
                    reader.onload = function(e) {
                    var $img = $('<img>').attr("src", e.target.result);
                    $(id1).empty().append($img);
                    }
                    reader.readAsDataURL(file)
                    }
                };
                
                // 若类型传参错误 则返回上一个页面
                if(type == "0"){
                    appcan.window.close(-1); 
                    return false;
                }
                
                switch(type){
                    case "A1":
                        $("#typeName").text("名优活动");
                        break;
                    case "B2":
                        $("#typeName").text("同城购活动");
                        break;
                    case "C1":
                        $("#typeName").text("超市模块");
                        break;
                    case "D1":
                        $("#typeName").text("婴育模块");
                        break;
                    case "E1":
                        $("#typeName").text("车辆模块");
                        break;
                    case "F1":
                        $("#typeName").text("房产模块");
                        break;
                    case "C2":
                        $("#typeName").text("超市模块");
                        break;
                    case "D2":
                        $("#typeName").text("婴育模块");
                        break;
                    case "E2":
                        $("#typeName").text("车辆模块");
                        break;
                    case "F2":
                        $("#typeName").text("房产模块");
                        break;
                }
                
                //类型为1 隐藏类型2
                //位置代码
                $("#typeNum").text(num);
                $("#code").val(type);
                if(num == 1){
                    $("#type2").hide();
                }else{
                    $("#type1").hide();
                }
                
                // 预览
                $("#preview").click(function(){
                    saveAct("preview");
                })
                
                // 下一步
                $("#nextStep").click(function(){
                    saveAct("nextStep");
                })
                
                // 异步保存当前页面信息
                function saveAct(obj){
                    // 数据校验
                    if($.trim($("#code").val()).length == 0){
                        appcan.window.alert({
                            title:'提示',
                            content:'位置代码不能为空',
                            buttons:'确定'
                        });
                        return false;
                    }
                    if($("#type2").is(':visible') && $.trim($("#summary").val()).length == 0){
                        appcan.window.alert({
                            title:'提示',
                            content:'活动简介不能为空',
                            buttons:'确定'
                        });
                        return false;
                    }
                    if($.trim($("#detailSummary").val()).length == 0){
                        appcan.window.alert({
                            title:'提示',
                            content:'活动简介不能为空',
                            buttons:'确定'
                        });
                        return false;
                    }
                    
                    var baseParam = {
                        userId : appcan.locStorage.getVal("userId")
                    };
                    var param = $("#actForm").serializeJson(baseParam);
                    var result = null;
                    appcan.ajax({
                       type:"post",
                       async:false,       
                       url:host+"/saveAct.json",
                       data:param,
                       dataType:"json",
                       contentType: "application/json",
                       success : function(dataResult) {
                            result = dataResult;
                            if(obj == "preview"){
                               if(result.status > 0){
                                    openUrl("../page/info.html?actId="+result.data,"actInfo");
                               }
                            }else{
                               if(result.status > 0){
                                    // 只有超市 婴育
                                    if(type=="C1" || type=="C2" || type=="D1" || type=="D2"){
                                        openUrl("good_edit.html?type="+type+"&actId="+result.data,"good_edit");
                                    }else{
                                        openUrl("moban_shiyong.html?type="+type+"&actId="+result.data,"moban_shiyong");
                                    }
                               }
                           }
                       }
                   })
                }
            })
            
            // 上传图片
            function uploadImg(){
                var data = {
                    min:1,
                    max:1,
                    quality:0.8,
                    detailedInfo:true
                }
                uexImage.openPicker(data,function(error,info){
                    //上传图片
                    var baseParam = {
                        userId : appcan.locStorage.getVal("userId"),
                        file : info.detailedImageInfo
                    };
                    var param = JSON.stringify(baseParam);
                    appcan.ajax({
                       type:"post",      
                       url:host+"/image/uploadImg.json",
                       data:param,
                       dataType:"json",
                       contentType: "application/json",
                       success : function(dataResult) {
                            $("mainPic").attr("src", dataResult.imgUrl);
                       }
                   })
                });
            }
        </script>
	</body>

</html>