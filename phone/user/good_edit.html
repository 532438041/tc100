<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="description" content="" />
        <meta name="keywords" content="" />
        <meta name="author" content="Flying hormone" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta charset="UTF-8">
        <link rel="stylesheet" href="../css/mui.min.css" />
        <script type="text/javascript" src="../js/jquery-1.9.1.js"></script>
        <script type="text/javascript" src="../js/jquery.Query.js" ></script>
        <script type="text/javascript" src="../js/jquery-cookie.js"></script>
        <script type="text/javascript" src="../js/mui.min.js"></script>
        <script type="text/javascript" src="../js/appcan.js"></script>
        <script type="text/javascript" src="../js/appcan.control.js"></script>
        <script type="text/javascript" src="../js/common.js" ></script>
		<title>编辑</title>
		<style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                -moz-box-sizing: border-box;
                -webkit-box-sizing: border-box;
            }
            
            body {
                width: 100%;
                overflow-x: hidden;
                font-family: "微软雅黑";
                background: #f8f8f8;
                font-size: 1em;
                padding-bottom: 3.875em;
            }
            
            h1,
            h2,
            h3,
            h4,
            h5,
            h6 {
                font-weight: normal;
                margin: 0;
            }
            
            p {
                margin: 0;
                font-size: 0.6rem;
            }
            
            header {
                background: #ff3366;
                height: 3em;
                overflow: hidden;
                position: relative;
            }
            
            header h1 {
                font-size: 1.5em;
                text-align: center;
                color: #fff;
                line-height: 2em;
                font-weight: normal;
                margin: 0;
            }
            
            header a {
                position: absolute;
                height: 100%;
            }
            
            header a img {
                height: 2em;
            }
            
            .dingwei img {
                position: absolute;
                top: 1em;
                left: 0.3125em;
            }
            
            .dingwei span {
                display: block;
                line-height: 1.5em;
                font-size: 2em;
                color: #fff;
            }
            
            .xiaoxi {
                color: #fff;
                font-size: 1em;
                text-align: right;
                line-height: 2em;
                position: absolute;
                top: 0.75em;
                right: 0.3125em;
                height: 1.5em;
                width: 3.875em;
                background: url(img/pen.png) no-repeat;
                background-size: auto 100%;
            }
            
            .lunbo {
                position: relative;
            }
            
            .lunbo img {
                width: 100%;
            }
            
            .lunbo .more {
                text-align: center;
                font-size: 0.75em;
                color: #fff;
                position: absolute;
                top: 0;
                right: 0;
                background: url(img/opa.png) repeat;
                width: 3.125em;
                height: 1.25em;
            }
            
            .lunbo span.mui-icon {
                font-size: 0.75em;
            }
            
            .lanmu {
                height: auto;
                overflow: hidden;
            }
            
            .lanmu nav {
                width: 90%;
                margin: 0 auto;
                margin-top: 1em;
                font-size: 1em;
            }
            
            .lanmu a {
                display: block;
                float: left;
                width: 25%;
            }
            
            .lanmu a img {
                width: 70%;
                display: block;
                margin: 0 auto;
            }
            
            .lanmu span {
                display: block;
                text-align: center;
                color: #333;
                margin: 0.3125em 0;
            }
            
            .same_city_buy {
                margin-top: 0.625em;
            }
            
            .same_city_buy h2 {
                background: #ff5256;
                color: #fff;
                padding: 0.625em;
                font-size: 1.125em;
                line-height: 1.5em;
            }
            
            .same_city_buy h2 span {
                float: right;
            }
            
            .same_city_buy>p {
                background: #f9efc9;
                text-align: center;
                position: relative;
                line-height: 1.875em;
            }
            
            .same_city_buy>p a {
                position: absolute;
                right: 0.3125em;
                color: #ff5256;
            }
            
            .same_city_buy i {
                font-style: normal;
                position: absolute;
                top: 0.625em;
                right: 1em;
                color: #999;
            }
            
            .same_city_buy .mui-table-view .mui-media-object {
                max-width: 22%;
                height: auto;
            }
            
            .same_city_buy .mui-table-view-cell>a:not(.mui-btn) {
                white-space: normal;
            }
            
            .same_city_buy .mui-ellipsis {
                white-space: normal;
            }
            
            .shucailei {
                margin-top: 0.625em;
                height: auto;
                overflow: hidden;
                background: #fff;
            }
            
            .shucailei h2 {
                background: #fff;
                color: #666;
                padding: 0.625em;
                font-size: 0.875em;
                line-height: 1.5em;
                position: relative;
            }
            
            .shucailei h2 span {
                float: left;
            }
            
            .shucailei h2 a {
                position: absolute;
                z-index: 100;
                right: 1em;
                color: #666;
                border: 1px solid #ff3366;
                padding: 0 0.625em;
                border-radius: 0.3125em;
            }
            
            input[type=text]{
                line-height: 2.5em;
                height: 2.5em;
                margin-bottom: 0;
                border: none;
            }
            
            .shucailei>p {
                background: #f9efc9;
                text-align: center;
                position: relative;
                line-height: 1.875em;
            }
            
            .shucailei>p a {
                position: absolute;
                right: 0.3125em;
                color: #ff5256;
            }
            
            .shucailei i {
                font-style: normal;
                color: #ff3366;
                margin-right: 0.625em;
                font-size: 0.5rem;
            }
            
            .shucailei .mui-table-view .mui-media-object {
                max-width: 30%;
                height: auto;
            }
            
            .shucailei .mui-table-view-cell>a:not(.mui-btn) {
                white-space: normal;
            }
            
            .shucailei .mui-ellipsis {
                white-space: normal;
            }
            
            .shucailei .search {
                background: #87d4fe;
                border: none;
                height: 2em;
                position: absolute;
                width: 60%;
                padding: 0;
                margin: 0 auto;
                margin-top: 0.3125em;
                display: block;
                top: 0;
                left: 20%;
            }
            
            .shucailei .search input[type=text] {
                background: none;
                border: none;
                text-indent: 0.625em;
                padding: 0;
                margin: 0;
                height: 1.5em;
                font-size: 0.75em;
                width: 100%;
                height: 100%;
            }
            
            .shucailei .search img {
                height: 60%;
                position: absolute;
                top: 0.3125em;
                right: 0.3125em;
            }
            .shucailei li{
                padding: 0.625em;
            }
            .shucailei>span{
                display: inline-block;
                width: 46%;
                float: left;
                text-align: center;
                color: #ff3366;
                background: #fff;
                border: 1px solid #ff3366;
                padding: 0 5%;
                margin: 0 2%;
                line-height: 1.5em;
            }
            .shucailei>span a{
                color: #ff3366;
            }
            .shucailei>span:last-child{
                background: #ff3366;
                color: #fff;
            }
            .shucailei>span:last-child a{
                color: #fff;
            }
            .mui-media-body{
                padding-right: 1.875em;
            }
            .del_bianji{
                position: absolute;
                top: 0.625em;
                right: 0;
                font-size: 0.6rem;
            }
            .del_bianji a{
                color: #999;
                padding: 0.125em 0.375em;
                margin-right: 0.3125em;
                border: 1px solid #ccc;
            }
            .buff{
                height: 1.875em;
            }
            .buff a{
                width: 50%;
                display: block;
                float: left;
                color: #999;
                background: #fff;
                line-height: 1.875em;
                text-align: center;
                border-right: 1px solid #eee;
                line-height: 2.375em;
            }
            .buff a.active{ color: #ff3366;}
            
            footer nav a{
                    display: table-cell;
                    overflow: hidden;
                    width: 1%;
                    height: 3.125em;
                    text-align: center;
                    vertical-align: middle;
                    white-space: nowrap;
                    text-overflow: ellipsis;
                    color: #929292;
            }
            
            footer nav a img {
                width: 15%;
                display: block;
                margin: 0 auto;
                margin-top: 0.3125em;
                margin-bottom: 0.1em;
            }
            
            footer nav span {
                color: #020202;
            }
            
            footer nav .action span {
                color: #ff3366;
            }
            .mui-table-view-cell>a:not(.mui-btn){
                padding: 0;
            }
        </style>
	</head>

	<body>
		<header>
			<a class="dingwei"><span class="mui-icon mui-icon-back"></span></a>
			<h1>编辑</h1>
		</header>
		<section class="buff">
			<a class="active">正在发布</a>
			<a>已下架</a>
		</section>
		
		<section class="shucailei" id="addView">
			<h2><input type="text" value="" id="cateName" placeholder="分类名称" /><a href="javascript:;" onclick="addGood();">添加商品</a></h2>
			<div>
				<ul class="mui-table-view">
					<li class="mui-table-view-cell mui-media">
						
					</li>
				</ul>
			</div>
			<span><a id="preview">预览</a></span>
            <span><a id="nextStep">下一步</a></span>
		</section>
		<footer>
			<nav class="mui-bar mui-bar-tab">
				<a class="action" href="javascript:;" id="tcIndex">
                    <img src="../img/shouye.png" />
                    <span class="mui-tab-label">首页</span>
                </a>
                <a href="javascript:;" id="myfabu">
                    <img src="../img/fabu2.png" />
                    <span class="mui-tab-label">发布</span>
                </a>
                <a href="javascript:;" id="myInfo">
                    <img src="../img/mine.png" />
                    <span class="mui-tab-label">我的</span>
                </a>
			</nav>
		</footer>
<script>
//获取已添加的商品
var type = $.query.get("type");
var actId = $.query.get("actId");

$(function(){
    
    // 获取默认名片
    $.ajax({
       type:"get",
       url:host+"/getActItem.json?actId="+actId,
       dataType:"json",
       success : function(dataResult) {
           var data = dataResult.data;
           var str = '';
           for (var i=0; i < data.length; i++) {
             str+='<section class="shucailei"><h2><span class="kaihe mui-icon mui-icon-arrowdown"></span>'
             +data[i].cateName+'<a href="javascript:;" onclick="addGood(\''
             +data[i].cateId+'\');">添加商品</a></h2>'
             +'<div><ul class="mui-table-view">';
             var itemList = data[i].itemList;
             for (var j=0; j < itemList.length; j++) {
               str+='<li class="mui-table-view-cell mui-media"><div><img class="mui-media-object mui-pull-left" src="'
               + hostIp+itemList[j].itemPic +'"><div class="mui-media-body">品名：'
               +itemList[j].itemName +'<p><i>特价：'
               +itemList[j].spePrice +'元/'
               +itemList[j].speUnit+'g</i>原价：<s>'
               +itemList[j].listPrice+'元/'
               +itemList[j].listUnit+'g</s></p><p>时间：'
               +itemList[j].startTime+'-'
               +itemList[j].endTime+'</p><p class="mui-ellipsis">说明：'
               +itemList[j].remark+'</p></div><p class="del_bianji"><a>删除</a><a>编辑</a></p></div></li>';
             };
             str+='</ul></div></section>';
           };
           
           $("#addView").before(str);
           $(".kaihe").click(function(){
                if($(this).is(".mui-icon-arrowdown")){
                    $(this).removeClass("mui-icon-arrowdown");
                    $(this).addClass("mui-icon-arrowup");
                    $(this).parent("h2").next("div").hide();
                }else{
                    $(this).removeClass("mui-icon-arrowup");
                    $(this).addClass("mui-icon-arrowdown");
                    $(this).parent("h2").next("div").show();
                }
            });
       }
   });
   
   // 预览
    $("#preview").click(function(){
        appcan.window.open({
            name:"page_info",
            dataType:0,
            data:"../page/info.html?type="+type+"&actId="+actId
        });
    })
    
    // 下一步
    $("#nextStep").click(function(){
        appcan.window.open({
            name:"moban_shiyong",
            dataType:0,
            data:"moban_shiyong.html?type="+type+"&actId="+actId
        });
    })
    
});

function addGood(cateId){
    if($("#cateName").val().length == 0){
        alert("请先填写分类名称");
        return false;
    }
    // 保存分类
    $.ajax({
       type:"post",
       url:host+"/saveItemCate.json?id="+(cateId||"")+"&cateName="+$("#cateName").val()+"&actId="+actId,
       dataType:"json",
       success : function(dataResult) {
           appcan.window.open({
                name:"add_good",
                dataType:0,
                data:"add_good.html?type="+type+"&actId="+actId+"&cateId="+dataResult.data
            });
       }
   });
}

</script>
	</body>

</html>