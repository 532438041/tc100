<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="description" content="" />
        <meta name="keywords" content="" />
        <meta name="author" content="Flying hormone" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta charset="UTF-8">
        <link rel="stylesheet" href="../css/mui.min.css" />
        <script type="text/javascript" src="../js/jquery-1.9.1.js"></script>
        <script type="text/javascript" src="../js/jquery.Query.js" ></script>
        <script type="text/javascript" src="../js/jquery-cookie.js"></script>
        <script type="text/javascript" src="../js/mui.min.js"></script>
        <script type="text/javascript" src="../js/appcan.js"></script>
        <script type="text/javascript" src="../js/appcan.control.js"></script>
        <script type="text/javascript" src="../js/common.js" ></script>
		<title>添加商品</title>
		<style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                -moz-box-sizing: border-box;
                -webkit-box-sizing: border-box;
            }
            
            body {
                width: 100%;
                overflow-x: hidden;
                font-family: "微软雅黑";
                background: #f8f8f8;
                font-size: 1em;
                padding-bottom: 3.875em;
            }
            
            h1,
            h2,
            h3,
            h4,
            h5,
            h6 {
                font-weight: normal;
                margin: 0;
            }
            
            p {
                margin: 0;
                background: #fff;
                padding: 0.625em;
                font-size: 0.6em;
                line-height: 1em;
                padding-top: 1.25em;
                color: #333;
            }
            
            header {
                background: #ff3366;
                height: 3em;
                overflow: hidden;
                position: relative;
            }
            
            header h1 {
                font-size: 1.5em;
                text-align: center;
                color: #fff;
                line-height: 2em;
                font-weight: normal;
                margin: 0;
            }
            
            header a {
                position: absolute;
                height: 100%;
            }
            
            header a img {
                height: 2em;
            }
            
            .dingwei img {
                position: absolute;
                top: 1em;
                left: 0.3125em;
            }
            
            .dingwei span {
                display: block;
                line-height: 1.5em;
                font-size: 2em;
                color: #fff;
            }
            
            input{ background: none; border: 1px solid;}
            input[type=text]{ border-color: #ccc;}
            input[type="button"]{ background: none;}
            p,span{ font-size: 0.8em; color: #999;}
            .top input{ }
            .top{ height: 7.5em;  overflow: hidden; position: relative; background: #fff; border-bottom: 1px solid #dedede;}
            .top span{ display: block; height: 3.875em; line-height: 3.875em; text-indent: 1.25em;}
            .top a{ display: inline-block; text-align: center;  color: #ff3366; padding: 0 1.5em; margin-left: 1.25em; border: 1px solid #ff3366; }
            .top>div{ height: 6.25em;   position: absolute; top: 0.625em; right: 0.625em;  overflow: hidden;}
            .top>div img{  height: 100%;}
            
            
            .main{ background: #fff;}
            .main p{ border-bottom: 1px solid #ccc; text-indent: 0; padding-top: 0.625em; padding-right: 0; width: 50%; float: left;}
            .main input{ display: inline; width: 60%; margin-bottom: 0; padding: 0;}
            .main i{  font-style: normal;  float: left; text-align: right; line-height: 1.875em;}
            .main input[type="text"]{ height: 1.875em; margin-right: 0.25em;}
            .main textarea{ width: 75%; margin-bottom: 0;}
            .main input[type=button]{ background: #ff3366; border: none; width: 40%; position: relative; left: 50%; margin-bottom: 1em; }
            #upload0{ display: none;}
            p.w100{ width: 100%;}
            p.w100 input{  width: 75%;}
            input.submit{ padding: 0.3125em;}
            
            
            footer nav a{
                    display: table-cell;
                    overflow: hidden;
                    width: 1%;
                    height: 3.125em;
                    text-align: center;
                    vertical-align: middle;
                    white-space: nowrap;
                    text-overflow: ellipsis;
                    color: #929292;
            }
            
            footer nav a img {
                width: 15%;
                display: block;
                margin: 0 auto;
                margin-top: 0.3125em;
                margin-bottom: 0.1em;
            }
            
            footer nav span {
                color: #020202;
            }
            
            footer nav .action span {
                color: #ff3366;
            }
            
        </style>
	</head>

	<body>
		<header>
			<a class="dingwei"><span class="mui-icon mui-icon-back"></span></a>
			<h1>添加商品</h1>
		</header>
		<section class="quyu">
			<form id="goodForm">
				<div class="top">
					<span>商品图片</span>
					<a id="btn1">上传</a>
					<p>上传图片大小请在1M以下</p>
					<div id="yulan"><img id="itemPic" src="../img/img_4.png" /></div>
				</div>
				<div class="main">
					<p class="w100"><i>品名：</i><input type="text" value="" name="itemName"/></p>
					<p><i>原价：</i><input type="text" value="" name="listPrice"/>斤</p>
					<p><i>V：</i><input type="text" value="" name="listUnit"/></p>
					<p><i>特价：</i><input type="text" value="" name="spePrice"/>斤</p>
					<p><i>V：</i><input type="text" value="" name="speUnit"/></p>
					<p class="w100"><i>开始时间：</i><input type="date" value="" name="startTime"/></p>
					<p class="w100"><i>结束时间：</i><input type="date" value="" name="endTime"/></p>
					<p class="w100" style="border: none; clear: both;"><i>说明：</i><textarea type="text" value="" name="remark"/></textarea></p>
					<input class="submit" type="button" value="完成" onclick="saveItem();"/>
				</div>
			</form>
		</section>
		

		<footer>
			<nav class="mui-bar mui-bar-tab">
				<a class="action" href="javascript:;" id="tcIndex">
                    <img src="../img/shouye.png" />
                    <span class="mui-tab-label">首页</span>
                </a>
                <a href="javascript:;" id="myfabu">
                    <img src="../img/fabu2.png" />
                    <span class="mui-tab-label">发布</span>
                </a>
                <a href="javascript:;" id="myInfo">
                    <img src="../img/mine.png" />
                    <span class="mui-tab-label">我的</span>
                </a>
			</nav>
		</footer>
<script>

var itemId = getVal("itemId");
var actId = getVal("actId");
var cateId = getVal("cateId");
var type = getVal("type");

$(document).ready(function(){  
    if(!!itemId){
        // 绑定数据
        appcan.ajax({
           type:"get",
           url:host+"/getItem.json?itemId="+itemId,
           dataType:"json",
           success : function(dataResult) {
               var data = dataResult.data;
               $("input[name='itemName']").val(data.itemName);
               $("input[name='listPrice']").val(data.listPrice);
               $("input[name='listUnit']").val(data.listUnit);
               $("input[name='spePrice']").val(data.spePrice);
               $("input[name='speUnit']").val(data.speUnit);
               $("input[name='startTime']").val(data.startTime);
               $("input[name='endTime']").val(data.endTime);
               $("input[name='remark']").val(data.remark);
           }
       });
    }
    
	$(".top").append('<input id="upload0" type="file" accept="image/jpeg,image/bmp" />');
	$("#btn1").click(function(){
		fileSelect(yulan,'#upload'+0);
	});
  	function fileSelect(id1,id2) {
        $(id2).click(); 
		 $(function() {
		 $(id2).one("change",function(e) {
        var file = e.target.files[0];
        console.log(file.size/1024);
        if(file.size/1024 > 1024){
            alert("请选择1M大小 以下的图片");
        }else{
            preview1(file);
        }
		 })
		 })
		function preview1(file) {
		 var img = new Image();
		 var url = img.src = URL.createObjectURL(file);
		 var $img = $(img);
		 
		 img.onload = function() {
		 URL.revokeObjectURL(url);
		 $(id1).empty();
		 $(id1).append($img);
		 
		 }
		 }
		 function preview2(file) {
		 var reader = new FileReader()
		 reader.onload = function(e) {
		 var $img = $('<img>').attr("src", e.target.result);
		 $(id1).empty().append($img);
		 }
		 reader.readAsDataURL(file)
		 }
	};
});

function saveItem(){
    var baseParam = {
        id : itemId,
        cateId:cateId,
        actId:actId
    };
    var param = $("#goodForm").serializeJson(baseParam);
    var result = null;
    appcan.ajax({
       type:"post",
       url:host+"/saveItem.json",
       data:param,
       dataType:"json",
       contentType: "application/json",
       success : function(dataResult) {
           openUrl("good_edit.html?type="+type+"&actId="+actId,"good_edit");
       }
   })
}
</script>
	</body>

</html>